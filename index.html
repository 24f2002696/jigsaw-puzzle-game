<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jigsaw Puzzle</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: sans-serif;
            background-color: #f8f9fa;
        }

        #game-container {
            width: 800px;
            margin: 20px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #puzzle-container {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 20px auto;
            border: 1px solid #ccc;
        }

        .puzzle-piece {
            position: absolute;
            width: auto;
            height: auto;
            cursor: grab;
            border: 1px solid #eee;
        }

        .puzzle-piece.correct {
            border: 2px solid green;
        }

        #controls {
            margin-top: 20px;
            text-align: center;
        }

        #stats {
            text-align: center;
            margin-bottom: 10px;
        }

        #victory-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding-top: 20%;
            z-index: 1000;
        }

        #preview-image {
            max-width: 400px;
            max-height: 400px;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="game-container">
        <h1>Jigsaw Puzzle</h1>

        <div id="stats">
            Time: <span id="timer">0</span> seconds | Moves: <span id="moves">0</span>
        </div>

        <div id="puzzle-container"></div>

        <div id="controls">
            <div class="form-group">
                <label for="difficulty">Difficulty:</label>
                <select class="form-control" id="difficulty">
                    <option value="3">Easy (3x3)</option>
                    <option value="4">Medium (4x4)</option>
                    <option value="5">Hard (5x5)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="imageSelect">Select Image:</label>
                <select class="form-control" id="imageSelect">
                    <option value="image1.jpg">Image 1</option>
                    <option value="image2.jpg">Image 2</option>
                    <option value="image3.jpg">Image 3</option>
                </select>
            </div>
            <button class="btn btn-primary" id="new-game-btn">New Game</button>
            <button class="btn btn-info" id="preview-btn">Preview</button>
            <button class="btn btn-secondary" id="reset-btn">Reset</button>

        </div>
    </div>
</div>


<div id="victory-screen">
    <h2>Congratulations!</h2>
    <p>You solved the puzzle in <span id="victory-time"></span> seconds with <span id="victory-moves"></span> moves.</p>
    <button class="btn btn-success" id="close-victory">Close</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script>
    $(document).ready(function() {
        // Configuration
        const puzzleContainer = $('#puzzle-container');
        const imageSelect = $('#imageSelect');
        let gridSize = 3; // Default difficulty
        let pieces = [];
        let correctPositions = [];
        let pieceWidth, pieceHeight;
        let moves = 0;
        let startTime = 0;
        let timerInterval;
        let currentImage = 'image1.jpg'; // Default image
        const snapThreshold = 20; // Pixel distance for snapping
        const images = ['image1.jpg', 'image2.jpg', 'image3.jpg'];

        // Preload images
        const imageCache = {};
        images.forEach(image => {
            imageCache[image] = new Image();
            imageCache[image].src = image;
        });

        // Event listeners for difficulty and buttons
        $('#difficulty').change(function() {
            gridSize = parseInt($(this).val());
            newGame();
        });

        imageSelect.change(function() {
            currentImage = $(this).val();
            newGame();
        });

        $('#new-game-btn').click(newGame);
        $('#reset-btn').click(resetGame);
        $('#close-victory').click(closeVictory);

        $('#preview-btn').click(function() {
            // Create and display the preview image
            let previewImage = $('<img id="preview-image" src="' + currentImage + '" alt="Preview">');
            puzzleContainer.empty().append(previewImage);

            // Set a timeout to remove the preview after a few seconds
            setTimeout(function() {
                puzzleContainer.empty(); // Clear the preview image
                initializePuzzle();      // Re-initialize the puzzle
            }, 3000); // 3 seconds
        });

        // Timer functions
        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function updateTimer() {
            const elapsedTime = Math.floor((Date.now() - startTime) / 1000);
            $('#timer').text(elapsedTime);
        }

        // Move counter function
        function incrementMoves() {
            moves++;
            $('#moves').text(moves);
        }

        // Victory screen functions
        function showVictory() {
            stopTimer();
            $('#victory-time').text($('#timer').text());
            $('#victory-moves').text(moves);
            $('#victory-screen').show();
        }

        function closeVictory() {
            $('#victory-screen').hide();
        }

        // Initialize the puzzle
        function newGame() {
            stopTimer();
            resetStats();
            initializePuzzle();
        }

        // Reset the current game
        function resetGame() {
            stopTimer();
            resetStats();
            shufflePieces();
            startTime = Date.now();
            startTimer();
        }

        function resetStats() {
            moves = 0;
            $('#moves').text(moves);
            $('#timer').text(0);
        }

        function initializePuzzle() {
            puzzleContainer.empty();
            pieces = [];
            correctPositions = [];
            moves = 0;
            $('#moves').text(0);
            $('#timer').text(0);

            const image = new Image();
            image.src = currentImage;
            image.onload = function() {
                pieceWidth = image.width / gridSize;
                pieceHeight = image.height / gridSize;

                puzzleContainer.width(image.width);
                puzzleContainer.height(image.height);


                for (let row = 0; row < gridSize; row++) {
                    for (let col = 0; col < gridSize; col++) {
                        const x = col * pieceWidth;
                        const y = row * pieceHeight;

                        const piece = $('<div class="puzzle-piece"></div>')
                            .css({
                                'width': pieceWidth + 'px',
                                'height': pieceHeight + 'px',
                                'background-image': `url(${currentImage})`,
                                'background-position': `-${x}px -${y}px`,
                                'position': 'absolute',
                                'left': x + 'px',
                                'top': y + 'px'
                            })
                            .data('col', col)
                            .data('row', row)
                            .draggable({
                                containment: "parent",
                                stop: function(event, ui) {
                                    incrementMoves();
                                    checkPosition($(this));
                                }
                            });

                        pieces.push(piece);
                        correctPositions.push({x: x, y: y});
                    }
                }

                shufflePieces();
                startTime = Date.now();
                startTimer();
            };
        }

        // Shuffle the puzzle pieces
        function shufflePieces() {
            pieces = shuffle(pieces);
            puzzleContainer.empty();
            pieces.forEach(piece => {
                const randomX = Math.floor(Math.random() * (puzzleContainer.width() - pieceWidth));
                const randomY = Math.floor(Math.random() * (puzzleContainer.height() - pieceHeight));
                piece.css({
                    'left': randomX + 'px',
                    'top': randomY + 'px'
                });
                puzzleContainer.append(piece);
            });
        }

        // Fisher-Yates shuffle algorithm
        function shuffle(array) {
            let currentIndex = array.length, temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }

        // Check if a piece is in the correct position and snap it
        function checkPosition(piece) {
            const col = piece.data('col');
            const row = piece.data('row');
            const correctX = col * pieceWidth;
            const correctY = row * pieceHeight;
            const currentX = piece.position().left;
            const currentY = piece.position().top;

            if (Math.abs(currentX - correctX) < snapThreshold && Math.abs(currentY - correctY) < snapThreshold) {
                piece.draggable('disable')
                    .css({
                        'left': correctX + 'px',
                        'top': correctY + 'px',
                        'cursor': 'default'
                    })
                    .addClass('correct');

                // Check if all pieces are in the correct position
                if ($('.puzzle-piece:not(.correct)').length === 0) {
                    showVictory();
                }
            }
        }

        // Initialize the game on document ready
        newGame();
    });
</script>

</body>
</html>